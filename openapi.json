{"openapi":"3.1.0","info":{"title":"Chorus API","description":"Anonymous-by-design social network API","version":"1.0.0"},"paths":{"/api/v1/auth/challenge":{"post":{"tags":["authentication"],"summary":"Issue a proof-of-work and signature challenge","description":"Provide clients with challenge material for register/login flows.","operationId":"issue_challenge_api_v1_auth_challenge_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChallengeRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChallengeResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/auth/register":{"post":{"tags":["authentication"],"summary":"Register a new anonymous key","description":"Register or upsert an anonymous Ed25519 identity.","operationId":"register_user_api_v1_auth_register_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/auth/login":{"post":{"tags":["authentication"],"summary":"Authenticate with Ed25519 key","description":"Authenticate by providing a signed challenge response.","operationId":"login_user_api_v1_auth_login_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/posts/":{"get":{"tags":["posts"],"summary":"List Posts","description":"List posts in deterministic order with optional filters.\n\nArgs:\n    db: Database session\n    limit: Maximum number of posts to return (max 100)\n    before: Return posts before this order_index for pagination\n    community_slug: Filter posts by community internal slug\n\nReturns:\n    List of Post objects in descending order by order_index\n\nRaises:\n    HTTPException: If community not found when filtering by slug","operationId":"list_posts_api_v1_posts__get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"description":"Maximum number of posts to return","default":50,"title":"Limit"},"description":"Maximum number of posts to return"},{"name":"before","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"description":"Return posts before this order_index","title":"Before"},"description":"Return posts before this order_index"},{"name":"community_slug","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by community slug","title":"Community Slug"},"description":"Filter by community slug"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/PostResponse"},"title":"Response List Posts Api V1 Posts  Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"post":{"tags":["posts"],"summary":"Create Post","description":"Create a new post with proof of work verification.\n\nArgs:\n    post_data: Post creation data including content, PoW, and optional parent/community\n    current_user: Authenticated user creating the post\n    db: Database session\n    pow_service: Proof-of-work service for verification\n\nReturns:\n    Created Post object\n\nRaises:\n    HTTPException: If PoW insufficient, replay detected, content hash mismatch,\n                  parent post not found, or community not found","operationId":"create_post_api_v1_posts__post","security":[{"HTTPBearer":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PostCreate"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PostResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/posts/{post_id}":{"get":{"tags":["posts"],"summary":"Get Post","description":"Get a specific post by ID.\n\nArgs:\n    post_id: ID of the post to retrieve\n    db: Database session\n\nReturns:\n    Post object\n\nRaises:\n    HTTPException: If post not found or deleted","operationId":"get_post_api_v1_posts__post_id__get","parameters":[{"name":"post_id","in":"path","required":true,"schema":{"type":"integer","title":"Post Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PostResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["posts"],"summary":"Delete Post","description":"Soft-delete a post (visible to author only).\n\nArgs:\n    post_id: ID of the post to delete\n    current_user: Authenticated user (must be post author)\n    db: Database session\n\nRaises:\n    HTTPException: If post not found or user is not the author","operationId":"delete_post_api_v1_posts__post_id__delete","security":[{"HTTPBearer":[]}],"parameters":[{"name":"post_id","in":"path","required":true,"schema":{"type":"integer","title":"Post Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/posts/{post_id}/children":{"get":{"tags":["posts"],"summary":"Get Post Children","description":"Get replies to a post in deterministic order.\n\nArgs:\n    post_id: ID of the parent post\n    db: Database session\n    limit: Maximum number of replies to return (max 100)\n    before: Return replies before this order_index for pagination\n\nReturns:\n    List of Post objects that are replies to the specified post","operationId":"get_post_children_api_v1_posts__post_id__children_get","parameters":[{"name":"post_id","in":"path","required":true,"schema":{"type":"integer","title":"Post Id"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"default":50,"title":"Limit"}},{"name":"before","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Before"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/PostResponse"},"title":"Response Get Post Children Api V1 Posts  Post Id  Children Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/votes/":{"post":{"tags":["votes"],"summary":"Cast Vote","description":"Cast a vote on a post with proof of work verification.\n\nArgs:\n    vote_data: Vote creation data including post ID, direction, and PoW\n    current_user: Authenticated user casting the vote\n    db: Database session\n    pow_service: Proof-of-work service for verification\n    replay_service: Replay protection service\n\nReturns:\n    Dictionary with success status\n\nRaises:\n    HTTPException: If post not found, invalid PoW, replay detected,\n                  or harmful vote cooldown active","operationId":"cast_vote_api_v1_votes__post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/VoteCreate"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":{"type":"string"},"type":"object","title":"Response Cast Vote Api V1 Votes  Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/v1/votes/{post_id}/my-vote":{"get":{"tags":["votes"],"summary":"Get My Vote","description":"Get current user's vote on a specific post.\n\nArgs:\n    post_id: ID of the post to check vote for\n    current_user: Authenticated user\n    db: Database session\n\nReturns:\n    Dictionary with vote direction (1 for upvote, -1 for downvote, 0 for no vote)","operationId":"get_my_vote_api_v1_votes__post_id__my_vote_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"post_id","in":"path","required":true,"schema":{"type":"integer","title":"Post Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":{"type":"integer"},"title":"Response Get My Vote Api V1 Votes  Post Id  My Vote Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/communities/":{"get":{"tags":["communities"],"summary":"List Communities","description":"List all communities.","operationId":"list_communities_api_v1_communities__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/CommunityResponse"},"type":"array","title":"Response List Communities Api V1 Communities  Get"}}}}}},"post":{"tags":["communities"],"summary":"Create Community","description":"Create a new community.","operationId":"create_community_api_v1_communities__post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CommunityCreate"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CommunityResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/v1/communities/{community_id}":{"get":{"tags":["communities"],"summary":"Get Community","description":"Get a specific community by ID.","operationId":"get_community_api_v1_communities__community_id__get","parameters":[{"name":"community_id","in":"path","required":true,"schema":{"type":"integer","title":"Community Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CommunityResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/communities/{community_id}/join":{"post":{"tags":["communities"],"summary":"Join Community","description":"Join a community.","operationId":"join_community_api_v1_communities__community_id__join_post","security":[{"HTTPBearer":[]}],"parameters":[{"name":"community_id","in":"path","required":true,"schema":{"type":"integer","title":"Community Id"}}],"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":{"type":"string"},"title":"Response Join Community Api V1 Communities  Community Id  Join Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/communities/{community_id}/leave":{"delete":{"tags":["communities"],"summary":"Leave Community","description":"Leave a community.","operationId":"leave_community_api_v1_communities__community_id__leave_delete","security":[{"HTTPBearer":[]}],"parameters":[{"name":"community_id","in":"path","required":true,"schema":{"type":"integer","title":"Community Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/communities/{community_id}/posts":{"get":{"tags":["communities"],"summary":"Get Community Posts","description":"Get posts from a specific community.","operationId":"get_community_posts_api_v1_communities__community_id__posts_get","parameters":[{"name":"community_id","in":"path","required":true,"schema":{"type":"integer","title":"Community Id"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":50,"title":"Limit"}},{"name":"before","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Before"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/PostResponse"},"title":"Response Get Community Posts Api V1 Communities  Community Id  Posts Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/communities/{community_id}/top-authors":{"get":{"tags":["communities"],"summary":"Get Top Authors","description":"Top authors in a community by selected metric.\n\nMetrics:\n  - posts: total posts authored in the community\n  - engagement: (upvotes + downvotes) across authored posts\n  - harmful_ratio: downvotes / max(1, upvotes + downvotes)","operationId":"get_top_authors_api_v1_communities__community_id__top_authors_get","parameters":[{"name":"community_id","in":"path","required":true,"schema":{"type":"integer","title":"Community Id"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":10,"title":"Limit"}},{"name":"metric","in":"query","required":false,"schema":{"type":"string","default":"posts","title":"Metric"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","additionalProperties":true},"title":"Response Get Top Authors Api V1 Communities  Community Id  Top Authors Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/messages/":{"post":{"tags":["messages"],"summary":"Send Message","description":"Send an end-to-end encrypted direct message.\n\nArgs:\n    message_data: Message creation data including recipient, ciphertext, and PoW\n    current_user: Authenticated user sending the message\n    db: Database session\n    pow_service: Proof-of-work service for verification\n\nReturns:\n    Dictionary with status and message ID\n\nRaises:\n    HTTPException: If recipient not found, invalid PoW, or base64 decode error","operationId":"send_message_api_v1_messages__post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DirectMessageCreate"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Send Message Api V1 Messages  Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/v1/messages/inbox":{"get":{"tags":["messages"],"summary":"Get Inbox","description":"Get encrypted messages for current user (as recipient).\n\nArgs:\n    current_user: Authenticated user\n    db: Database session\n    limit: Maximum number of messages to return (max 100)\n    before: Return messages before this order_index for pagination\n\nReturns:\n    List of serialized message dictionaries","operationId":"get_inbox_api_v1_messages_inbox_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"default":50,"title":"Limit"}},{"name":"before","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Before"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","additionalProperties":true},"title":"Response Get Inbox Api V1 Messages Inbox Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/messages/sent":{"get":{"tags":["messages"],"summary":"Get Sent Messages","description":"Get encrypted messages sent by current user.\n\nArgs:\n    current_user: Authenticated user\n    db: Database session\n    limit: Maximum number of messages to return (max 100)\n    before: Return messages before this order_index for pagination\n\nReturns:\n    List of serialized message dictionaries","operationId":"get_sent_messages_api_v1_messages_sent_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"default":50,"title":"Limit"}},{"name":"before","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Before"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","additionalProperties":true},"title":"Response Get Sent Messages Api V1 Messages Sent Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/messages/{message_id}/read":{"put":{"tags":["messages"],"summary":"Mark Message Read","description":"Mark a direct message as read/delivered.\n\nArgs:\n    message_id: ID of the message to mark as read\n    current_user: Authenticated user (must be recipient)\n    db: Database session\n\nReturns:\n    Dictionary with status confirmation\n\nRaises:\n    HTTPException: If message not found or user is not the recipient","operationId":"mark_message_read_api_v1_messages__message_id__read_put","security":[{"HTTPBearer":[]}],"parameters":[{"name":"message_id","in":"path","required":true,"schema":{"type":"integer","title":"Message Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":{"type":"string"},"title":"Response Mark Message Read Api V1 Messages  Message Id  Read Put"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/moderation/queue":{"get":{"tags":["moderation"],"summary":"Get Moderation Queue","description":"Get posts currently in the moderation queue.","operationId":"get_moderation_queue_api_v1_moderation_queue_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"default":50,"title":"Limit"}},{"name":"before","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Before"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/PostResponse"},"title":"Response Get Moderation Queue Api V1 Moderation Queue Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/moderation/trigger":{"post":{"tags":["moderation"],"summary":"Trigger Moderation","description":"Trigger moderation for a post using a moderation token.","operationId":"trigger_moderation_api_v1_moderation_trigger_post","security":[{"HTTPBearer":[]}],"parameters":[{"name":"post_id","in":"query","required":true,"schema":{"type":"integer","title":"Post Id"}}],"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":{"anyOf":[{"type":"integer"},{"type":"string"}]},"title":"Response Trigger Moderation Api V1 Moderation Trigger Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/moderation/vote":{"post":{"tags":["moderation"],"summary":"Vote On Moderation","description":"Vote on whether a post is harmful.","operationId":"vote_on_moderation_api_v1_moderation_vote_post","security":[{"HTTPBearer":[]}],"parameters":[{"name":"post_id","in":"query","required":true,"schema":{"type":"integer","title":"Post Id"}},{"name":"is_harmful","in":"query","required":true,"schema":{"type":"boolean","description":"Whether the post is considered harmful","title":"Is Harmful"},"description":"Whether the post is considered harmful"}],"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":{"type":"string"},"title":"Response Vote On Moderation Api V1 Moderation Vote Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/moderation/history":{"get":{"tags":["moderation"],"summary":"Get Moderation History","description":"Get moderation history for posts authored by the current user.","operationId":"get_moderation_history_api_v1_moderation_history_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"default":50,"title":"Limit"}},{"name":"before","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Before"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","additionalProperties":{"type":"integer"}},"title":"Response Get Moderation History Api V1 Moderation History Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/moderation/community/{internal_slug}/stats":{"get":{"tags":["moderation"],"summary":"Get Community Moderation Stats","description":"Aggregated moderation stats for a community (by slug).","operationId":"get_community_moderation_stats_api_v1_moderation_community__internal_slug__stats_get","parameters":[{"name":"internal_slug","in":"path","required":true,"schema":{"type":"string","title":"Internal Slug"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Response Get Community Moderation Stats Api V1 Moderation Community  Internal Slug  Stats Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/moderation/community/{internal_slug}/cases":{"get":{"tags":["moderation"],"summary":"List Community Cases","description":"List case summaries within a specific community (by slug).","operationId":"list_community_cases_api_v1_moderation_community__internal_slug__cases_get","parameters":[{"name":"internal_slug","in":"path","required":true,"schema":{"type":"string","title":"Internal Slug"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"default":50,"title":"Limit"}},{"name":"before","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Before"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","additionalProperties":{"type":"integer"}},"title":"Response List Community Cases Api V1 Moderation Community  Internal Slug  Cases Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/moderation/ledger":{"get":{"tags":["moderation"],"summary":"Get Moderation Ledger","description":"Public anonymized ledger of moderation activity across the network.","operationId":"get_moderation_ledger_api_v1_moderation_ledger_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":200,"default":50,"title":"Limit"}},{"name":"before","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Before"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","additionalProperties":true},"title":"Response Get Moderation Ledger Api V1 Moderation Ledger Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/moderation/community/{internal_slug}/ledger":{"get":{"tags":["moderation"],"summary":"Get Community Moderation Ledger","description":"Public anonymized ledger of moderation activity within a community.","operationId":"get_community_moderation_ledger_api_v1_moderation_community__internal_slug__ledger_get","parameters":[{"name":"internal_slug","in":"path","required":true,"schema":{"type":"string","title":"Internal Slug"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":200,"default":50,"title":"Limit"}},{"name":"before","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Before"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","additionalProperties":true},"title":"Response Get Community Moderation Ledger Api V1 Moderation Community  Internal Slug  Ledger Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/moderation/case/{post_id}/summary":{"get":{"tags":["moderation"],"summary":"Get Case Summary","description":"Return a summary of moderation voting for a specific post.","operationId":"get_case_summary_api_v1_moderation_case__post_id__summary_get","parameters":[{"name":"post_id","in":"path","required":true,"schema":{"type":"integer","title":"Post Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":{"type":"integer"},"title":"Response Get Case Summary Api V1 Moderation Case  Post Id  Summary Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/moderation/cases":{"get":{"tags":["moderation"],"summary":"List Case Summaries","description":"List recent moderation cases with anonymized summaries.","operationId":"list_case_summaries_api_v1_moderation_cases_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"default":50,"title":"Limit"}},{"name":"before","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Before"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","additionalProperties":{"type":"integer"}},"title":"Response List Case Summaries Api V1 Moderation Cases Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/system/config":{"get":{"tags":["system","transparency"],"summary":"Get Public Config","description":"Return a sanitized snapshot of public runtime configuration.\n\nExcludes secrets and connection strings; suitable for transparency UIs.\n\nArgs:\n    pow_service: Proof-of-work service for difficulty configuration\n\nReturns:\n    Dictionary containing public configuration including app settings,\n    PoW difficulties, moderation thresholds, and bridge status","operationId":"get_public_config_api_v1_system_config_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Get Public Config Api V1 System Config Get"}}}}}}},"/api/v1/system/clock":{"get":{"tags":["system","transparency"],"summary":"Get Clock","description":"Expose the monotonic system clock for transparency and tooling.\n\nArgs:\n    db: Database session\n\nReturns:\n    Dictionary with current day_seq and hour_seq values","operationId":"get_clock_api_v1_system_clock_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":{"type":"integer"},"type":"object","title":"Response Get Clock Api V1 System Clock Get"}}}}}}},"/api/v1/system/moderation-stats":{"get":{"tags":["system","transparency"],"summary":"Get Moderation Stats","description":"Return aggregated moderation statistics without revealing identities.\n\nArgs:\n    db: Database session\n\nReturns:\n    Dictionary containing case counts, vote statistics, per-community data,\n    and top flagged posts for transparency reporting","operationId":"get_moderation_stats_api_v1_system_moderation_stats_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Get Moderation Stats Api V1 System Moderation Stats Get"}}}}}}},"/api/v1/system/activity-stats":{"get":{"tags":["system","transparency"],"summary":"Get Activity Stats","description":"Network-wide activity counters (anonymized).\n\nArgs:\n    db: Database session\n\nReturns:\n    Dictionary with counts of users, communities, posts, votes, and messages","operationId":"get_activity_stats_api_v1_system_activity_stats_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":{"type":"integer"},"type":"object","title":"Response Get Activity Stats Api V1 System Activity Stats Get"}}}}}}},"/api/v1/system/bridge/health":{"get":{"tags":["system","transparency"],"summary":"Get Bridge Health","description":"Get Bridge health status and circuit breaker information.\n\nReturns:\n    Dictionary with bridge status, health information, and error details","operationId":"get_bridge_health_api_v1_system_bridge_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Get Bridge Health Api V1 System Bridge Health Get"}}}}}}},"/api/v1/system/bridge/metrics":{"get":{"tags":["system","transparency"],"summary":"Get Bridge Metrics","description":"Get Bridge operation metrics and performance data.\n\nReturns:\n    Dictionary with bridge operation metrics and performance statistics","operationId":"get_bridge_metrics_api_v1_system_bridge_metrics_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Get Bridge Metrics Api V1 System Bridge Metrics Get"}}}}}}},"/api/v1/system/health":{"get":{"tags":["system","transparency"],"summary":"Get System Health","description":"Comprehensive health check endpoint for Stage service monitoring.\n\nArgs:\n    db: Database session\n\nReturns:\n    Dictionary with overall system status, component health, and version info","operationId":"get_system_health_api_v1_system_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Get System Health Api V1 System Health Get"}}}}}}},"/api/v1/system/metrics":{"get":{"tags":["system","transparency"],"summary":"Get System Metrics","description":"Get comprehensive system metrics for monitoring.\n\nArgs:\n    db: Database session\n\nReturns:\n    Dictionary with database health, activity metrics, moderation stats,\n    and bridge status for monitoring dashboards","operationId":"get_system_metrics_api_v1_system_metrics_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Get System Metrics Api V1 System Metrics Get"}}}}}}},"/api/v1/system/status":{"get":{"tags":["system","transparency"],"summary":"Get System Status","description":"Get overall system status for monitoring dashboards.\n\nReturns:\n    Dictionary with service information, version, status, and environment","operationId":"get_system_status_api_v1_system_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Get System Status Api V1 System Status Get"}}}}}}},"/api/v1/users/{user_id}/summary":{"get":{"tags":["users","transparency"],"summary":"Get User Summary","description":"Return an anonymized overview of a user's activity.\n\nInput is URL-safe base64 of user_id (BLAKE3(pubkey)).","operationId":"get_user_summary_api_v1_users__user_id__summary_get","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Response Get User Summary Api V1 Users  User Id  Summary Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/users/{user_id}/recent-posts":{"get":{"tags":["users","transparency"],"summary":"Get User Recent Posts","description":"List recent posts authored by the user (anonymized fields only).","operationId":"get_user_recent_posts_api_v1_users__user_id__recent_posts_get","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"default":20,"title":"Limit"}},{"name":"before","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Before"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","additionalProperties":true},"title":"Response Get User Recent Posts Api V1 Users  User Id  Recent Posts Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/users/me/profile":{"get":{"tags":["users","transparency"],"summary":"Get My Profile","description":"Get current user's profile information.\n\nReturns the authenticated user's display name and accent color.","operationId":"get_my_profile_api_v1_users_me_profile_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProfileResponse"}}}}},"security":[{"HTTPBearer":[]}]},"patch":{"tags":["users","transparency"],"summary":"Update My Profile","description":"Update current user's profile information.\n\nUpdates only the provided fields (partial update). Both display_name and \naccent_color are optional. If a field is not provided, it will not be changed.","operationId":"update_my_profile_api_v1_users_me_profile_patch","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProfileUpdateRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProfileResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/v1/users/{user_id}/communities":{"get":{"tags":["users","transparency"],"summary":"Get User Communities","description":"Return communities a user has posted in with post counts.\n\nCross-community linking is inherent to a given user_id; users wanting siloed\npersonas should use distinct keys per context.","operationId":"get_user_communities_api_v1_users__user_id__communities_get","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","additionalProperties":true},"title":"Response Get User Communities Api V1 Users  User Id  Communities Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/health":{"get":{"summary":"Health Check","description":"Health check endpoint to verify the service is running.","operationId":"health_check_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":{"type":"string"},"type":"object","title":"Response Health Check Health Get"}}}}}}},"/":{"get":{"summary":"Root","description":"Root endpoint with basic information about the API.","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":{"type":"string"},"type":"object","title":"Response Root  Get"}}}}}}}},"components":{"schemas":{"ChallengeRequest":{"properties":{"pubkey":{"type":"string","title":"Pubkey","description":"Base64-encoded Ed25519 public key (32 bytes)"},"intent":{"type":"string","enum":["register","login"],"title":"Intent","description":"Handshake intent"}},"type":"object","required":["pubkey","intent"],"title":"ChallengeRequest","description":"Request to obtain a registration/login challenge."},"ChallengeResponse":{"properties":{"pow_target":{"type":"string","title":"Pow Target","description":"Server-supplied PoW challenge identifier"},"pow_difficulty":{"type":"integer","title":"Pow Difficulty","description":"Difficulty clients must satisfy"},"signature_challenge":{"type":"string","title":"Signature Challenge","description":"Base64 challenge that must be signed"}},"type":"object","required":["pow_target","pow_difficulty","signature_challenge"],"title":"ChallengeResponse","description":"Challenge payload returned to clients before authentication."},"CommunityCreate":{"properties":{"internal_slug":{"type":"string","title":"Internal Slug"},"display_name":{"type":"string","title":"Display Name"},"description_md":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description Md"}},"type":"object","required":["internal_slug","display_name"],"title":"CommunityCreate","description":"Schema for creating a new community."},"CommunityResponse":{"properties":{"id":{"type":"integer","title":"Id"},"internal_slug":{"type":"string","title":"Internal Slug"},"display_name":{"type":"string","title":"Display Name"},"description_md":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description Md"},"is_profile_like":{"type":"boolean","title":"Is Profile Like"},"order_index":{"type":"integer","title":"Order Index"}},"type":"object","required":["id","internal_slug","display_name","description_md","is_profile_like","order_index"],"title":"CommunityResponse","description":"Schema for community information returned by the API."},"DirectMessageCreate":{"properties":{"ciphertext":{"type":"string","title":"Ciphertext","description":"Base64-encoded PGP-encrypted message content"},"recipient_pubkey_hex":{"type":"string","title":"Recipient Pubkey Hex","description":"Hex-encoded public key of recipient"},"header_blob":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Header Blob","description":"Optional base64-encoded encryption header"},"pow_nonce":{"type":"string","title":"Pow Nonce","description":"Proof of work nonce"},"hash_algorithm":{"type":"string","title":"Hash Algorithm","description":"Hash algorithm used for proof of work (blake3 or sha256)","default":"blake3"}},"type":"object","required":["ciphertext","recipient_pubkey_hex","pow_nonce"],"title":"DirectMessageCreate","description":"Schema for creating a new direct message."},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"LoginRequest":{"properties":{"pubkey":{"type":"string","title":"Pubkey","description":"Base64-encoded Ed25519 public key (32 bytes)"},"pow":{"$ref":"#/components/schemas/PowEnvelope"},"proof":{"$ref":"#/components/schemas/SignatureProof"}},"type":"object","required":["pubkey","pow","proof"],"title":"LoginRequest","description":"Schema for login submissions."},"LoginResponse":{"properties":{"access_token":{"type":"string","title":"Access Token","description":"JWT access token"},"token_type":{"type":"string","title":"Token Type","description":"Token type (typically 'bearer')"},"session_nonce":{"type":"string","title":"Session Nonce","description":"Ephemeral nonce for client session binding"}},"type":"object","required":["access_token","token_type","session_nonce"],"title":"LoginResponse","description":"Response returned after successful login."},"PostCreate":{"properties":{"content_md":{"type":"string","maxLength":5000,"minLength":1,"title":"Content Md","description":"Markdown content"},"parent_post_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Parent Post Id","description":"Parent post ID for comments"},"community_internal_slug":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Community Internal Slug","description":"Community slug"},"pow_nonce":{"type":"string","title":"Pow Nonce","description":"Proof of work nonce"},"pow_difficulty":{"type":"integer","minimum":15.0,"title":"Pow Difficulty","description":"Proof of work difficulty"},"pow_hash_algorithm":{"type":"string","title":"Pow Hash Algorithm","description":"Hash algorithm used for proof of work (blake3 or sha256)","default":"blake3"},"content_hash":{"type":"string","title":"Content Hash","description":"Hash of the content for integrity verification"}},"type":"object","required":["content_md","pow_nonce","pow_difficulty","content_hash"],"title":"PostCreate","description":"Schema for creating a new post."},"PostResponse":{"properties":{"id":{"type":"integer","title":"Id"},"order_index":{"type":"integer","title":"Order Index"},"author_user_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Author User Id"},"author_pubkey":{"type":"string","title":"Author Pubkey"},"parent_post_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Parent Post Id"},"community_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Community Id"},"body_md":{"type":"string","title":"Body Md"},"content_hash":{"type":"string","title":"Content Hash"},"moderation_state":{"type":"integer","title":"Moderation State"},"harmful_vote_count":{"type":"integer","title":"Harmful Vote Count"},"upvotes":{"type":"integer","title":"Upvotes"},"downvotes":{"type":"integer","title":"Downvotes"},"deleted":{"type":"boolean","title":"Deleted"},"federation_post_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Federation Post Id"},"federation_origin":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Federation Origin"}},"type":"object","required":["id","order_index","author_user_id","author_pubkey","parent_post_id","community_id","body_md","content_hash","moderation_state","harmful_vote_count","upvotes","downvotes","deleted"],"title":"PostResponse","description":"Schema for post information returned by the API."},"PowEnvelope":{"properties":{"nonce":{"type":"string","title":"Nonce","description":"Client-computed PoW nonce"},"difficulty":{"type":"integer","minimum":1.0,"title":"Difficulty","description":"Difficulty (leading zero bits) satisfied"},"target":{"type":"string","title":"Target","description":"Opaque PoW challenge identifier"},"hash_algorithm":{"type":"string","title":"Hash Algorithm","description":"Hash algorithm used for proof of work (blake3 or sha256)","default":"blake3"}},"type":"object","required":["nonce","difficulty","target"],"title":"PowEnvelope","description":"Payload describing the proof-of-work presented during authentication."},"ProfileResponse":{"properties":{"display_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Display Name","description":"User's display name"},"accent_color":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Accent Color","description":"User's accent color"}},"type":"object","required":["display_name","accent_color"],"title":"ProfileResponse","description":"Response schema for user profile information."},"ProfileUpdateRequest":{"properties":{"display_name":{"anyOf":[{"type":"string","maxLength":100,"minLength":1},{"type":"null"}],"title":"Display Name","description":"Optional persona label (1-100 characters)"},"accent_color":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Accent Color","description":"Optional hex color code (e.g., #FF5733)"}},"type":"object","title":"ProfileUpdateRequest","description":"Schema for updating user profile information."},"RegisterRequest":{"properties":{"pubkey":{"type":"string","title":"Pubkey","description":"Base64-encoded Ed25519 public key (32 bytes)"},"display_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Display Name","description":"Optional persona label"},"accent_color":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Accent Color","description":"Optional client-specified accent color"},"pow":{"$ref":"#/components/schemas/PowEnvelope"},"proof":{"$ref":"#/components/schemas/SignatureProof"}},"type":"object","required":["pubkey","pow","proof"],"title":"RegisterRequest","description":"Schema for anonymous key registration."},"RegisterResponse":{"properties":{"user_id":{"type":"string","title":"User Id","description":"URL-safe base64 encoded BLAKE3 digest of the public key"},"created":{"type":"boolean","title":"Created","description":"True if a new record was inserted"}},"type":"object","required":["user_id","created"],"title":"RegisterResponse","description":"Registration response containing the derived anonymous identifier."},"SignatureProof":{"properties":{"challenge":{"type":"string","title":"Challenge","description":"Opaque challenge string (base64 encoded)"},"signature":{"type":"string","title":"Signature","description":"Signature over the challenge"}},"type":"object","required":["challenge","signature"],"title":"SignatureProof","description":"Proof that the client controls the submitted public key."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"},"VoteCreate":{"properties":{"post_id":{"type":"integer","title":"Post Id"},"direction":{"type":"integer","enum":[-1,1],"title":"Direction","description":"1 for upvote, -1 for downvote"},"pow_nonce":{"type":"string","title":"Pow Nonce"},"client_nonce":{"type":"string","title":"Client Nonce"},"hash_algorithm":{"type":"string","title":"Hash Algorithm","description":"Hash algorithm used for proof of work (blake3 or sha256)","default":"blake3"}},"type":"object","required":["post_id","direction","pow_nonce","client_nonce"],"title":"VoteCreate","description":"Schema for creating a new vote."}},"securitySchemes":{"HTTPBearer":{"type":"http","scheme":"bearer"}}}}